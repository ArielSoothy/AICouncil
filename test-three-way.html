<!DOCTYPE html>
<html>
<head>
    <title>Test Three-Way Comparison</title>
</head>
<body>
    <h1>Testing Three-Way Comparison Data Flow</h1>
    <button id="testBtn">Test Debate with Comparison</button>
    <pre id="output"></pre>

    <script>
        const output = document.getElementById('output');
        
        document.getElementById('testBtn').addEventListener('click', async () => {
            output.textContent = 'Starting test...\n';
            
            const eventSource = new EventSource('/api/agents/debate-stream', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    query: "What are the best electric scooters under $1000?",
                    agents: [
                        { provider: 'groq', model: 'llama-3.3-70b-versatile', enabled: true },
                        { provider: 'groq', model: 'llama-3.1-8b-instant', enabled: true },
                        { provider: 'google', model: 'gemini-2.5-flash', enabled: true }
                    ],
                    responseMode: 'concise',
                    round1Mode: 'llm',
                    rounds: 1,
                    includeComparison: true,
                    comparisonModel: { provider: 'groq', model: 'llama-3.3-70b-versatile' },
                    includeConsensusComparison: true,
                    consensusModels: [
                        { provider: 'groq', model: 'llama-3.3-70b-versatile' },
                        { provider: 'groq', model: 'llama-3.1-8b-instant' },
                        { provider: 'google', model: 'gemini-2.5-flash' }
                    ]
                })
            });
            
            eventSource.onmessage = (event) => {
                const data = JSON.parse(event.data);
                output.textContent += `\nEvent: ${data.type}\n`;
                
                if (data.type === 'consensus_comparison_completed') {
                    output.textContent += `Consensus Data: ${JSON.stringify(data.consensus, null, 2)}\n`;
                }
                
                if (data.type === 'synthesis_completed') {
                    output.textContent += `\nComparison: ${!!data.comparisonResponse}\n`;
                    output.textContent += `Consensus: ${!!data.consensusComparison}\n`;
                    output.textContent += `Synthesis: ${!!data.synthesis}\n`;
                    
                    if (data.consensusComparison) {
                        output.textContent += `\nConsensus Comparison Data:\n${JSON.stringify(data.consensusComparison, null, 2)}\n`;
                    }
                }
            };
            
            eventSource.onerror = (error) => {
                output.textContent += `\nError: ${error}\n`;
                eventSource.close();
            };
        });
    </script>
</body>
</html>